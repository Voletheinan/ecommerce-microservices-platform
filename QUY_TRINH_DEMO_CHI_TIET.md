# ğŸ“– QUY TRÃŒNH DEMO TOÃ€N Bá»˜ Há»† THá»NG - Step by Step

**Cáº­p nháº­t:** 2/12/2025  
**Má»¥c Ä‘Ã­ch:** HÆ°á»›ng dáº«n chi tiáº¿t quy trÃ¬nh tá»« Ä‘Äƒng kÃ½ â†’ mua hÃ ng â†’ thanh toÃ¡n â†’ giao hÃ ng â†’ Ä‘Ã¡nh giÃ¡

---

## ğŸ¯ Tá»”NG QUAN QUY TRÃŒNH

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NGÆ¯á»œI MUA (Customer)                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ÄÄƒng kÃ½ tÃ i khoáº£n                    â†’ localhost:8001            â”‚
â”‚ 2. ÄÄƒng nháº­p                            â†’ localhost:8001            â”‚
â”‚ 3. Xem danh sÃ¡ch sáº£n pháº©m               â†’ localhost:8002            â”‚
â”‚ 4. Xem chi tiáº¿t sáº£n pháº©m                â†’ localhost:8002            â”‚
â”‚ 5. Táº¡o Ä‘Æ¡n hÃ ng (thÃªm giá»)              â†’ localhost:8003            â”‚
â”‚ 6. Xem tÃ­nh giáº£m giÃ¡ (coupon)           â†’ localhost:8007            â”‚
â”‚ 7. Ãp dá»¥ng mÃ£ giáº£m giÃ¡                  â†’ localhost:8007            â”‚
â”‚ 8. Kiá»ƒm tra thuáº¿                        â†’ localhost:8012            â”‚
â”‚ 9. Thanh toÃ¡n                           â†’ localhost:8004            â”‚
â”‚ 10. Nháº­n thÃ´ng bÃ¡o thanh toÃ¡n           â†’ localhost:8011            â”‚
â”‚ 11. Tracking giao hÃ ng                  â†’ localhost:8006            â”‚
â”‚ 12. Nháº­n thÃ´ng bÃ¡o giao hÃ ng            â†’ localhost:8011            â”‚
â”‚ 13. ÄÃ¡nh giÃ¡ sáº£n pháº©m                   â†’ localhost:8008            â”‚
â”‚ 14. ThÃªm yÃªu thÃ­ch                      â†’ localhost:8010            â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ADMIN (Quáº£n lÃ½ cá»­a hÃ ng)                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ÄÄƒng nháº­p admin                      â†’ localhost:8001            â”‚
â”‚ 2. ThÃªm/sá»­a sáº£n pháº©m                    â†’ localhost:8002            â”‚
â”‚ 3. Kiá»ƒm tra kho                         â†’ localhost:8005            â”‚
â”‚ 4. XÃ¡c nháº­n Ä‘Æ¡n hÃ ng (quan sÃ¡t tráº¡ng thÃ¡i)                          â”‚
â”‚ 5. XÃ¡c nháº­n thanh toÃ¡n (quan sÃ¡t tráº¡ng thÃ¡i)                        â”‚
â”‚ 6. Táº¡o giao váº­n                         â†’ localhost:8006            â”‚
â”‚ 7. Kiá»ƒm tra Ä‘Ã¡nh giÃ¡                    â†’ localhost:8008            â”‚
â”‚ 8. Táº¡o khuyáº¿n mÃ£i                       â†’ localhost:8007            â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# ğŸ‘¤ PHáº¦N 1: NGÆ¯á»œI MUA (CUSTOMER FLOW)

## â±ï¸ BÆ°á»›c 1: Má»Ÿ TrÃ¬nh Duyá»‡t & ÄÄƒng KÃ½ TÃ i Khoáº£n

### 1.1 ÄÄƒng KÃ½ (Sign Up)

**URL:** `http://localhost:8001/api/users/register`  
**PhÆ°Æ¡ng thá»©c:** POST  
**CÃ´ng cá»¥:** PowerShell / Postman / curl

```powershell
# Má»Ÿ PowerShell vÃ  cháº¡y lá»‡nh nÃ y:
$register_response = curl -s -X POST "http://localhost:8001/api/users/register" `
  -H "Content-Type: application/json" `
  -d '{
    "email": "customer@example.com",
    "username": "customer_001",
    "password": "Customer@123",
    "full_name": "Nguyá»…n VÄƒn A",
    "phone": "0987654321",
    "address": "123 LÃª Lá»£i, Quáº­n 1, TP.HCM"
  }'

# Xem káº¿t quáº£
$register_response | ConvertFrom-Json | ConvertTo-Json -Depth 10
```

**Káº¿t quáº£ mong muá»‘n:**
```json
{
  "id": 1,
  "email": "customer@example.com",
  "username": "customer_001",
  "full_name": "Nguyá»…n VÄƒn A",
  "phone": "0987654321",
  "address": "123 LÃª Lá»£i, Quáº­n 1, TP.HCM",
  "is_active": true,
  "created_at": "2025-12-02T10:00:00Z",
  "updated_at": "2025-12-02T10:00:00Z"
}
```

âœ… **YÃªu cáº§u Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng!**  
**NÆ¡i lÆ°u:** MySQL database â†’ table `users`

---

## â±ï¸ BÆ°á»›c 2: ÄÄƒng Nháº­p & Láº¥y JWT Token

**URL:** `http://localhost:8001/api/users/login`  
**PhÆ°Æ¡ng thá»©c:** POST

```powershell
# ÄÄƒng nháº­p
$login_response = curl -s -X POST "http://localhost:8001/api/users/login" `
  -H "Content-Type: application/json" `
  -d '{
    "username": "customer_001",
    "password": "Customer@123"
  }'

# Láº¥y token
$login_data = $login_response | ConvertFrom-Json
$token = $login_data.access_token
$user_id = $login_data.user_id

# LÆ°u token Ä‘á»ƒ dÃ¹ng trong cÃ¡c bÆ°á»›c tiáº¿p theo
Write-Host "âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng!"
Write-Host "Token: $token"
Write-Host "User ID: $user_id"
Write-Host "Token Type: $($login_data.token_type)"
```

**Káº¿t quáº£:**
```
âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng!
Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZW1haWwiOiJjdXN0b21lckBleGFtcGxlLmNvbSIsImV4cCI6MTcyNDY5MDAwMH0.xxx
User ID: 1
Token Type: bearer
```

âœ… **Token sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng trong táº¥t cáº£ cÃ¡c request tiáº¿p theo (header: Authorization: Bearer $token)**

---

## â±ï¸ BÆ°á»›c 3: Xem Danh SÃ¡ch Sáº£n Pháº©m

**URL:** `http://localhost:8002/api/products`  
**PhÆ°Æ¡ng thá»©c:** GET  
**KhÃ´ng cáº§n token**

```powershell
# Xem danh sÃ¡ch sáº£n pháº©m (10 sáº£n pháº©m Ä‘áº§u tiÃªn)
$products_response = curl -s "http://localhost:8002/api/products?skip=0&limit=10"

$products_data = $products_response | ConvertFrom-Json
Write-Host "ğŸ“¦ Danh sÃ¡ch sáº£n pháº©m:"
Write-Host "Tá»•ng sáº£n pháº©m: $($products_data.total)"
Write-Host ""

$products_data.products | ForEach-Object {
    Write-Host "ID: $($_.id)"
    Write-Host "TÃªn: $($_.name)"
    Write-Host "GiÃ¡: $($_.price) VND"
    Write-Host "Kho: $($_.inventory_count) cÃ¡i"
    Write-Host "---"
}

# LÆ°u ID sáº£n pháº©m Ä‘áº§u tiÃªn Ä‘á»ƒ dÃ¹ng tiáº¿p
$product_id = $products_data.products[0].id
Write-Host "âœ… Product ID Ä‘á»ƒ mua: $product_id"
```

**Káº¿t quáº£ mong muá»‘n:**
```
ğŸ“¦ Danh sÃ¡ch sáº£n pháº©m:
Tá»•ng sáº£n pháº©m: 5

ID: 507f1f77bcf86cd799439011
TÃªn: iPhone 15 Pro
GiÃ¡: 29999000 VND
Kho: 50 cÃ¡i
---

ID: 507f1f77bcf86cd799439012
TÃªn: Samsung Galaxy S24
GiÃ¡: 24999000 VND
Kho: 30 cÃ¡i
---
```

---

## â±ï¸ BÆ°á»›c 4: Xem Chi Tiáº¿t Sáº£n Pháº©m

**URL:** `http://localhost:8002/api/products/{product_id}`  
**PhÆ°Æ¡ng thá»©c:** GET

```powershell
# Xem chi tiáº¿t sáº£n pháº©m (vÃ­ dá»¥: iPhone 15 Pro)
$product_id = "507f1f77bcf86cd799439011"
$product_detail = curl -s "http://localhost:8002/api/products/$product_id" | ConvertFrom-Json

Write-Host "ğŸ“± Chi tiáº¿t sáº£n pháº©m:"
Write-Host "TÃªn: $($product_detail.name)"
Write-Host "GiÃ¡: $($product_detail.price) VND"
Write-Host "MÃ´ táº£: $($product_detail.description)"
Write-Host "Danh má»¥c: $($product_detail.category)"
Write-Host "Kho: $($product_detail.inventory_count) cÃ¡i"
Write-Host "SKU: $($product_detail.sku)"
```

**Káº¿t quáº£:**
```
ğŸ“± Chi tiáº¿t sáº£n pháº©m:
TÃªn: iPhone 15 Pro
GiÃ¡: 29999000 VND
MÃ´ táº£: Äiá»‡n thoáº¡i thÃ´ng minh cao cáº¥p, chip A17 Pro
Danh má»¥c: Äiá»‡n Thoáº¡i
Kho: 50 cÃ¡i
SKU: IP15P-001
```

---

## â±ï¸ BÆ°á»›c 5: TÃ¬m Kiáº¿m Sáº£n Pháº©m (Search)

**URL:** `http://localhost:8009/api/search`  
**PhÆ°Æ¡ng thá»©c:** GET  
**TÃ¬m kiáº¿m qua Search Service**

```powershell
# TÃ¬m kiáº¿m sáº£n pháº©m
$search_query = "iPhone"
$search_result = curl -s "http://localhost:8009/api/search?q=$search_query&sort_by=price&order=asc" | ConvertFrom-Json

Write-Host "ğŸ” Káº¿t quáº£ tÃ¬m kiáº¿m: $search_query"
Write-Host "TÃ¬m Ä‘Æ°á»£c: $($search_result.results.Count) sáº£n pháº©m"
Write-Host ""

$search_result.results | ForEach-Object {
    Write-Host "- $($_.name): $($_.price) VND (Rating: $($_.rating)â­)"
}
```

---

## â±ï¸ BÆ°á»›c 6: Táº¡o ÄÆ¡n HÃ ng (Add to Cart & Create Order)

**URL:** `http://localhost:8003/api/orders`  
**PhÆ°Æ¡ng thá»©c:** POST  
**Cáº§n token**

```powershell
# Táº¡o Ä‘Æ¡n hÃ ng (giá» hÃ ng)
$product_id = "507f1f77bcf86cd799439011"
$product_price = 29999000
$quantity = 2

$order_response = curl -s -X POST "http://localhost:8003/api/orders" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $token" `
  -d @"
{
  "user_id": $user_id,
  "items": [
    {
      "product_id": "$product_id",
      "quantity": $quantity,
      "price": $product_price
    }
  ],
  "total_amount": $($product_price * $quantity),
  "status": "pending"
}
"@

$order_data = $order_response | ConvertFrom-Json
$order_id = $order_data.id

Write-Host "âœ… ÄÆ¡n hÃ ng Ä‘Æ°á»£c táº¡o!"
Write-Host "Order ID: $order_id"
Write-Host "Tráº¡ng thÃ¡i: $($order_data.status)"
Write-Host "Tá»•ng tiá»n: $($order_data.total_amount) VND (chÆ°a tÃ­nh thuáº¿, khuyáº¿n mÃ£i)"
```

**Káº¿t quáº£:**
```
âœ… ÄÆ¡n hÃ ng Ä‘Æ°á»£c táº¡o!
Order ID: 1
Tráº¡ng thÃ¡i: pending
Tá»•ng tiá»n: 59998000 VND (chÆ°a tÃ­nh thuáº¿, khuyáº¿n mÃ£i)
```

**Kafka Event Ä‘Æ°á»£c gá»­i:** `order-events` â†’ `{"order_id": 1, "status": "created"}`

---

## â±ï¸ BÆ°á»›c 7: Xem Danh SÃ¡ch Khuyáº¿n MÃ£i & Ãp Dá»¥ng MÃ£ Giáº£m GiÃ¡

**URL:** `http://localhost:8007/api/promotions`  
**PhÆ°Æ¡ng thá»©c:** GET

```powershell
# Xem danh sÃ¡ch khuyáº¿n mÃ£i Ä‘ang hoáº¡t Ä‘á»™ng
$promotions = curl -s "http://localhost:8007/api/promotions?status=active" | ConvertFrom-Json

Write-Host "ğŸ‰ Khuyáº¿n mÃ£i Ä‘ang hoáº¡t Ä‘á»™ng:"
$promotions.promotions | ForEach-Object {
    Write-Host "- $($_.name)"
    Write-Host "  Giáº£m: $($_.discount_value)% (Loáº¡i: $($_.discount_type))"
    Write-Host "  CÃ²n: $($_.max_usage - $_.current_usage) láº§n sá»­ dá»¥ng"
}
```

### Ãp Dá»¥ng MÃ£ Giáº£m GiÃ¡

**URL:** `http://localhost:8007/api/coupons/apply`  
**PhÆ°Æ¡ng thá»©c:** POST

```powershell
# Ãp dá»¥ng mÃ£ giáº£m giÃ¡ (náº¿u cÃ³)
$coupon_code = "BLACKFRIDAY50"  # VÃ­ dá»¥ mÃ£ giáº£m 50%
$original_amount = 59998000

$coupon_response = curl -s -X POST "http://localhost:8007/api/coupons/apply" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $token" `
  -d @"
{
  "coupon_code": "$coupon_code",
  "order_id": $order_id,
  "original_amount": $original_amount
}
"@

$coupon_data = $coupon_response | ConvertFrom-Json

Write-Host "ğŸ Ãp dá»¥ng khuyáº¿n mÃ£i:"
Write-Host "MÃ£: $($coupon_data.coupon_code)"
Write-Host "GiÃ¡ gá»‘c: $original_amount VND"
Write-Host "Giáº£m giÃ¡: $($coupon_data.discount_amount) VND"
Write-Host "GiÃ¡ sau giáº£m: $($coupon_data.final_amount) VND"

$amount_after_coupon = $coupon_data.final_amount
```

**Káº¿t quáº£:**
```
ğŸ Ãp dá»¥ng khuyáº¿n mÃ£i:
MÃ£: BLACKFRIDAY50
GiÃ¡ gá»‘c: 59998000 VND
Giáº£m giÃ¡: 29999000 VND
GiÃ¡ sau giáº£m: 29999000 VND
```

---

## â±ï¸ BÆ°á»›c 8: TÃ­nh ToÃ¡n Thuáº¿

**URL:** `http://localhost:8012/api/calculate-tax`  
**PhÆ°Æ¡ng thá»©c:** POST

```powershell
# TÃ­nh thuáº¿ (VAT 10%)
$tax_response = curl -s -X POST "http://localhost:8012/api/calculate-tax" `
  -H "Content-Type: application/json" `
  -d @"
{
  "order_id": $order_id,
  "amount": $amount_after_coupon,
  "location": "TP.HCM",
  "items": [
    {
      "product_id": "$product_id",
      "name": "iPhone 15 Pro",
      "quantity": 2,
      "price": 29999000
    }
  ]
}
"@

$tax_data = $tax_response | ConvertFrom-Json

Write-Host "ğŸ’° TÃ­nh toÃ¡n tá»•ng giÃ¡:"
Write-Host "GiÃ¡ sau khuyáº¿n mÃ£i: $($tax_data.subtotal) VND"
Write-Host "Thuáº¿ VAT (10%): $($tax_data.tax_amount) VND"
Write-Host "ğŸ”´ Tá»”NG Cá»˜NG: $($tax_data.total_with_tax) VND"

$final_total = $tax_data.total_with_tax
```

**Káº¿t quáº£:**
```
ğŸ’° TÃ­nh toÃ¡n tá»•ng giÃ¡:
GiÃ¡ sau khuyáº¿n mÃ£i: 29999000 VND
Thuáº¿ VAT (10%): 2999900 VND
ğŸ”´ Tá»”NG Cá»˜NG: 32998900 VND
```

---

## â±ï¸ BÆ°á»›c 9: THANH TOÃN

**URL:** `http://localhost:8004/api/payments`  
**PhÆ°Æ¡ng thá»©c:** POST  
**Cáº§n token**

```powershell
# Thanh toÃ¡n
$payment_response = curl -s -X POST "http://localhost:8004/api/payments" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $token" `
  -d @"
{
  "order_id": $order_id,
  "amount": $final_total,
  "payment_method": "credit_card",
  "card_number": "4111111111111111",
  "card_holder": "NGUYEN VAN A",
  "expiry_month": 12,
  "expiry_year": 2026,
  "cvv": "123",
  "status": "pending"
}
"@

$payment_data = $payment_response | ConvertFrom-Json
$payment_id = $payment_data.id

Write-Host "ğŸ’³ Thanh toÃ¡n Ä‘Æ°á»£c xá»­ lÃ½:"
Write-Host "Payment ID: $payment_id"
Write-Host "Sá»‘ tiá»n: $($payment_data.amount) VND"
Write-Host "Tráº¡ng thÃ¡i: $($payment_data.status)"
Write-Host "Transaction ID: $($payment_data.transaction_id)"
Write-Host "âœ… THANH TOÃN THÃ€NH CÃ”NG!"
```

**Káº¿t quáº£:**
```
ğŸ’³ Thanh toÃ¡n Ä‘Æ°á»£c xá»­ lÃ½:
Payment ID: 1
Sá»‘ tiá»n: 32998900 VND
Tráº¡ng thÃ¡i: completed
Transaction ID: TXN-2025-12-02-001
âœ… THANH TOÃN THÃ€NH CÃ”NG!
```

**Kafka Events Ä‘Æ°á»£c gá»­i:**
- `order-events` â†’ `{"order_id": 1, "status": "processing"}`
- `payment-events` â†’ `{"payment_id": 1, "order_id": 1, "status": "completed"}`

---

## â±ï¸ BÆ°á»›c 10: Nháº­n ThÃ´ng BÃ¡o Thanh ToÃ¡n

**URL:** `http://localhost:8011/api/notifications`  
**PhÆ°Æ¡ng thá»©c:** GET  
**Cáº§n token**

```powershell
# Kiá»ƒm tra thÃ´ng bÃ¡o
$notifications = curl -s "http://localhost:8011/api/notifications?user_id=$user_id&skip=0&limit=10" `
  -H "Authorization: Bearer $token" | ConvertFrom-Json

Write-Host "ğŸ“¬ ThÃ´ng bÃ¡o cá»§a báº¡n:"
Write-Host "Tá»•ng thÃ´ng bÃ¡o chÆ°a Ä‘á»c: $($notifications.unread_count)"
Write-Host ""

$notifications.notifications | ForEach-Object {
    $status = if ($_.read) { "âœ“" } else { "ğŸ†•" }
    Write-Host "$status [$($_.type)] $($_.title)"
    Write-Host "   $($_.message)"
    Write-Host "   LÃºc: $($_.created_at)"
}
```

**Káº¿t quáº£ (ThÃ´ng bÃ¡o tá»± Ä‘á»™ng Ä‘Æ°á»£c táº¡o):**
```
ğŸ“¬ ThÃ´ng bÃ¡o cá»§a báº¡n:
Tá»•ng thÃ´ng bÃ¡o chÆ°a Ä‘á»c: 3

ğŸ†• [order_created] ÄÆ¡n hÃ ng #1 Ä‘Ã£ Ä‘Æ°á»£c táº¡o
   ChÃºng tÃ´i Ä‘Ã£ nháº­n Ä‘Æ¡n hÃ ng cá»§a báº¡n
   LÃºc: 2025-12-02T10:05:00Z

ğŸ†• [payment_completed] Thanh toÃ¡n thÃ nh cÃ´ng
   Thanh toÃ¡n 32,998,900 VND Ä‘Ã£ xÃ¡c nháº­n
   LÃºc: 2025-12-02T10:06:00Z

ğŸ†• [shipping_update] Giao hÃ ng sáº¯p tá»›i
   ÄÆ¡n hÃ ng cá»§a báº¡n sáº¯p Ä‘Æ°á»£c giao
   LÃºc: 2025-12-02T10:07:00Z
```

---

## â±ï¸ BÆ°á»›c 11: Tracking Giao HÃ ng (Shipping)

**URL:** `http://localhost:8006/api/shipments`  
**PhÆ°Æ¡ng thá»©c:** GET

```powershell
# Kiá»ƒm tra giao váº­n
$shipments = curl -s "http://localhost:8006/api/shipments?order_id=$order_id" | ConvertFrom-Json

if ($shipments.shipments.Count -gt 0) {
    $shipment = $shipments.shipments[0]
    
    Write-Host "ğŸ“¦ Tracking Giao HÃ ng:"
    Write-Host "Tracking Number: $($shipment.tracking_number)"
    Write-Host "Carrier: $($shipment.carrier)"
    Write-Host "Tráº¡ng thÃ¡i: $($shipment.status)"
    Write-Host "Äá»‹a chá»‰ giao: $($shipment.address)"
    Write-Host "Dá»± kiáº¿n giao: $($shipment.estimated_delivery)"
}
```

**Káº¿t quáº£:**
```
ğŸ“¦ Tracking Giao HÃ ng:
Tracking Number: VN123456789
Carrier: GHN
Tráº¡ng thÃ¡i: pending
Äá»‹a chá»‰ giao: 123 LÃª Lá»£i, Quáº­n 1, TP.HCM
Dá»± kiáº¿n giao: 2025-12-05
```

### Xem Chi Tiáº¿t Tracking

```powershell
# Tracking chi tiáº¿t
$tracking_number = "VN123456789"
$tracking = curl -s "http://localhost:8006/api/shipments/track/$tracking_number" | ConvertFrom-Json

Write-Host "ğŸ“ Lá»‹ch sá»­ giao hÃ ng:"
$tracking.updates | ForEach-Object {
    Write-Host "[$($_.status)] - $($_.timestamp)"
}
```

**Káº¿t quáº£:**
```
ğŸ“ Lá»‹ch sá»­ giao hÃ ng:
[pending] - 2025-12-02T10:08:00Z
[picked_up] - 2025-12-02T11:00:00Z
[in_transit] - 2025-12-02T14:00:00Z
[out_for_delivery] - 2025-12-02T18:00:00Z
[delivered] - 2025-12-03T09:00:00Z
```

---

## â±ï¸ BÆ°á»›c 12: ThÃªm Sáº£n Pháº©m YÃªu ThÃ­ch

**URL:** `http://localhost:8010/api/favourites`  
**PhÆ°Æ¡ng thá»©c:** POST  
**Cáº§n token**

```powershell
# ThÃªm vÃ o yÃªu thÃ­ch
$favourite_response = curl -s -X POST "http://localhost:8010/api/favourites" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $token" `
  -d @"
{
  "user_id": $user_id,
  "product_id": "$product_id"
}
"@

$favourite_data = $favourite_response | ConvertFrom-Json
Write-Host "â¤ï¸ ThÃªm vÃ o yÃªu thÃ­ch thÃ nh cÃ´ng!"
Write-Host "Favourite ID: $($favourite_data.id)"

# Xem danh sÃ¡ch yÃªu thÃ­ch
$favourites = curl -s "http://localhost:8010/api/favourites?user_id=$user_id" `
  -H "Authorization: Bearer $token" | ConvertFrom-Json

Write-Host ""
Write-Host "ğŸ“‹ Danh sÃ¡ch yÃªu thÃ­ch cá»§a báº¡n:"
$favourites.favourites | ForEach-Object {
    Write-Host "- $($_.product.name): $($_.product.price) VND"
}
```

**Káº¿t quáº£:**
```
â¤ï¸ ThÃªm vÃ o yÃªu thÃ­ch thÃ nh cÃ´ng!
Favourite ID: 1

ğŸ“‹ Danh sÃ¡ch yÃªu thÃ­ch cá»§a báº¡n:
- iPhone 15 Pro: 29999000 VND
```

---

## â±ï¸ BÆ°á»›c 13: ÄÃ¡nh GiÃ¡ Sáº£n Pháº©m

**URL:** `http://localhost:8008/api/ratings`  
**PhÆ°Æ¡ng thá»©c:** POST  
**Cáº§n token**

```powershell
# ÄÃ¡nh giÃ¡ sáº£n pháº©m (chá»‰ sau khi Ä‘Ã£ nháº­n hÃ ng)
$rating_response = curl -s -X POST "http://localhost:8008/api/ratings" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $token" `
  -d @"
{
  "product_id": "$product_id",
  "user_id": $user_id,
  "rating": 5,
  "title": "Sáº£n pháº©m tuyá»‡t vá»i!",
  "comment": "iPhone 15 Pro ráº¥t tá»‘t. Cháº¥t lÆ°á»£ng camera cá»±c ká»³ xuáº¥t sáº¯c, hiá»‡u nÄƒng máº¡nh máº½. Giao hÃ ng nhanh, Ä‘Ã³ng gÃ³i cáº©n tháº­n. Ráº¥t hÃ i lÃ²ng!",
  "verified_purchase": true
}
"@

$rating_data = $rating_response | ConvertFrom-Json

Write-Host "â­ ÄÃ¡nh giÃ¡ sáº£n pháº©m:"
Write-Host "Rating ID: $($rating_data.id)"
Write-Host "Sao: $($rating_data.rating)/5"
Write-Host "Nháº­n xÃ©t: $($rating_data.comment)"
Write-Host "âœ… Cáº£m Æ¡n báº¡n Ä‘Ã£ Ä‘Ã¡nh giÃ¡!"
```

**Káº¿t quáº£:**
```
â­ ÄÃ¡nh giÃ¡ sáº£n pháº©m:
Rating ID: 1
Sao: 5/5
Nháº­n xÃ©t: iPhone 15 Pro ráº¥t tá»‘t. Cháº¥t lÆ°á»£ng camera cá»±c ká»³ xuáº¥t sáº¯c...
âœ… Cáº£m Æ¡n báº¡n Ä‘Ã£ Ä‘Ã¡nh giÃ¡!
```

### Xem ÄÃ¡nh GiÃ¡ Cá»§a Sáº£n Pháº©m

```powershell
# Xem táº¥t cáº£ Ä‘Ã¡nh giÃ¡
$product_ratings = curl -s "http://localhost:8008/api/ratings/product/$product_id" | ConvertFrom-Json

Write-Host "ğŸ“Š ÄÃ¡nh giÃ¡ sáº£n pháº©m:"
Write-Host "Äiá»ƒm trung bÃ¬nh: $($product_ratings.average_rating)/5"
Write-Host "Tá»•ng Ä‘Ã¡nh giÃ¡: $($product_ratings.total_ratings)"
Write-Host ""
Write-Host "CÃ¡c nháº­n xÃ©t:"
$product_ratings.ratings | ForEach-Object {
    Write-Host "- [$($_.rating)â­] $($_.title)"
    Write-Host "  NgÆ°á»i Ä‘Ã¡nh giÃ¡: $($_.user.username)"
    Write-Host "  $($_.comment)"
}
```

---

# ğŸ‘¨â€ğŸ’¼ PHáº¦N 2: ADMIN FLOW (Quáº£n LÃ½ Cá»­a HÃ ng)

## â±ï¸ Admin BÆ°á»›c 1: ÄÄƒng Nháº­p Admin

```powershell
# ÄÄƒng nháº­p vá»›i tÃ i khoáº£n admin
$admin_login = curl -s -X POST "http://localhost:8001/api/users/login" `
  -H "Content-Type: application/json" `
  -d '{
    "username": "admin_user",
    "password": "AdminPass@123"
  }'

$admin_data = $admin_login | ConvertFrom-Json
$admin_token = $admin_data.access_token

Write-Host "ğŸ‘¨â€ğŸ’¼ Admin Ä‘Äƒng nháº­p thÃ nh cÃ´ng!"
Write-Host "Admin Token: $admin_token"
```

---

## â±ï¸ Admin BÆ°á»›c 2: ThÃªm/Sá»­a Sáº£n Pháº©m

**URL:** `http://localhost:8002/api/products`  
**PhÆ°Æ¡ng thá»©c:** POST (thÃªm) / PUT (sá»­a)

```powershell
# ThÃªm sáº£n pháº©m má»›i (Admin)
$new_product = curl -s -X POST "http://localhost:8002/api/products" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $admin_token" `
  -d '{
    "name": "MacBook Pro M3",
    "description": "Laptop cao cáº¥p cho láº­p trÃ¬nh viÃªn",
    "price": 45000000,
    "inventory_count": 20,
    "category": "Laptop",
    "sku": "MBP-M3-001"
  }'

$new_product_data = $new_product | ConvertFrom-Json
Write-Host "âœ… Sáº£n pháº©m Ä‘Æ°á»£c thÃªm:"
Write-Host "ID: $($new_product_data.id)"
Write-Host "TÃªn: $($new_product_data.name)"
```

### Cáº­p Nháº­t Sáº£n Pháº©m

```powershell
# Sá»­a giÃ¡ sáº£n pháº©m
$update_product = curl -s -X PUT "http://localhost:8002/api/products/$product_id" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $admin_token" `
  -d '{
    "price": 27999000,
    "inventory_count": 45
  }'

Write-Host "âœ… Sáº£n pháº©m Ä‘Æ°á»£c cáº­p nháº­t"
```

---

## â±ï¸ Admin BÆ°á»›c 3: Kiá»ƒm Tra Kho HÃ ng

**URL:** `http://localhost:8005/api/inventory`  
**PhÆ°Æ¡ng thá»©c:** GET

```powershell
# Kiá»ƒm tra kho
$inventory = curl -s "http://localhost:8005/api/inventory/$product_id" | ConvertFrom-Json

Write-Host "ğŸ“¦ Kiá»ƒm tra kho:"
Write-Host "Sáº£n pháº©m: iPhone 15 Pro"
Write-Host "Tá»“n kho: $($inventory.quantity_in_stock) cÃ¡i"
Write-Host "ÄÃ£ Ä‘áº·t: $($inventory.quantity_reserved) cÃ¡i"
Write-Host "CÃ²n bÃ¡n: $($inventory.quantity_available) cÃ¡i"
Write-Host "Má»©c tÃ¡i nháº­p: $($inventory.reorder_level) cÃ¡i"

# Xem sáº£n pháº©m sáº¯p háº¿t
$low_stock = curl -s "http://localhost:8005/api/inventory/low-stock" | ConvertFrom-Json

Write-Host ""
Write-Host "âš ï¸ Sáº£n pháº©m sáº¯p háº¿t:"
$low_stock.low_stock_items | ForEach-Object {
    Write-Host "- $($_.product_name): $($_.quantity_in_stock) cÃ¡i (má»©c: $($_.reorder_level))"
}
```

---

## â±ï¸ Admin BÆ°á»›c 4: XÃ¡c Nháº­n ÄÆ¡n HÃ ng (Quan SÃ¡t Tráº¡ng ThÃ¡i)

**URL:** `http://localhost:8003/api/orders`  
**PhÆ°Æ¡ng thá»©c:** GET / PUT

```powershell
# Xem danh sÃ¡ch Ä‘Æ¡n hÃ ng
$orders = curl -s "http://localhost:8003/api/orders?skip=0&limit=20" | ConvertFrom-Json

Write-Host "ğŸ“‹ Danh sÃ¡ch Ä‘Æ¡n hÃ ng:"
$orders.orders | ForEach-Object {
    Write-Host "Order #$($_.id) - User: $($_.user_id)"
    Write-Host "  Tá»•ng tiá»n: $($_.total_amount) VND"
    Write-Host "  Tráº¡ng thÃ¡i: $($_.status)"
    Write-Host "  NgÃ y táº¡o: $($_.created_at)"
}

# Cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng
$update_order_status = curl -s -X PUT "http://localhost:8003/api/orders/$order_id/status" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $admin_token" `
  -d '{
    "status": "processing"
  }'

Write-Host ""
Write-Host "âœ… Tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng Ä‘Æ°á»£c cáº­p nháº­t thÃ nh: processing"
```

**Tráº¡ng thÃ¡i cÃ³ thá»ƒ:** pending â†’ processing â†’ shipped â†’ delivered â†’ cancelled

---

## â±ï¸ Admin BÆ°á»›c 5: XÃ¡c Nháº­n Thanh ToÃ¡n (Quan SÃ¡t)

```powershell
# Xem danh sÃ¡ch thanh toÃ¡n
$payments = curl -s "http://localhost:8004/api/payments?skip=0&limit=20" | ConvertFrom-Json

Write-Host "ğŸ’³ Danh sÃ¡ch thanh toÃ¡n:"
$payments.payments | ForEach-Object {
    Write-Host "Payment #$($_.id) - Order #$($_.order_id)"
    Write-Host "  Sá»‘ tiá»n: $($_.amount) VND"
    Write-Host "  Tráº¡ng thÃ¡i: $($_.status)"
    Write-Host "  Transaction ID: $($_.transaction_id)"
}

# Admin cÃ³ thá»ƒ kiá»ƒm tra vÃ  xÃ¡c nháº­n (há»‡ thá»‘ng tá»± Ä‘á»™ng confirm náº¿u khÃ´ng lá»—i)
Write-Host ""
Write-Host "âœ… Táº¥t cáº£ thanh toÃ¡n Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c nháº­n!"
```

---

## â±ï¸ Admin BÆ°á»›c 6: Táº¡o Giao Váº­n

**URL:** `http://localhost:8006/api/shipments`  
**PhÆ°Æ¡ng thá»©c:** POST

```powershell
# Táº¡o giao váº­n cho Ä‘Æ¡n hÃ ng
$create_shipment = curl -s -X POST "http://localhost:8006/api/shipments" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $admin_token" `
  -d @"
{
  "order_id": $order_id,
  "address": "123 LÃª Lá»£i, Quáº­n 1, TP.HCM",
  "phone": "0987654321",
  "carrier": "GHN",
  "status": "pending"
}
"@

$shipment_data = $create_shipment | ConvertFrom-Json

Write-Host "âœ… Giao váº­n Ä‘Æ°á»£c táº¡o:"
Write-Host "Shipment ID: $($shipment_data.id)"
Write-Host "Tracking Number: $($shipment_data.tracking_number)"
Write-Host "Carrier: $($shipment_data.carrier)"
Write-Host "Dá»± kiáº¿n giao: $($shipment_data.estimated_delivery)"
```

### Cáº­p Nháº­t Tráº¡ng ThÃ¡i Giao Váº­n

```powershell
# Cáº­p nháº­t tráº¡ng thÃ¡i giao váº­n (when picking up from warehouse)
curl -s -X PUT "http://localhost:8006/api/shipments/$($shipment_data.id)/status" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $admin_token" `
  -d '{"status": "picked_up"}'

# Sau Ä‘Ã³: in_transit
curl -s -X PUT "http://localhost:8006/api/shipments/$($shipment_data.id)/status" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $admin_token" `
  -d '{"status": "in_transit"}'

# Cuá»‘i cÃ¹ng: delivered
curl -s -X PUT "http://localhost:8006/api/shipments/$($shipment_data.id)/status" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $admin_token" `
  -d '{"status": "delivered"}'

Write-Host "âœ… Giao váº­n Ä‘Ã£ hoÃ n thÃ nh!"
```

---

## â±ï¸ Admin BÆ°á»›c 7: Táº¡o Khuyáº¿n MÃ£i

**URL:** `http://localhost:8007/api/promotions`  
**PhÆ°Æ¡ng thá»©c:** POST

```powershell
# Táº¡o khuyáº¿n mÃ£i
$create_promotion = curl -s -X POST "http://localhost:8007/api/promotions" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $admin_token" `
  -d '{
    "name": "Holiday 50% OFF",
    "description": "Giáº£m giÃ¡ 50% cho cÃ¡c sáº£n pháº©m Ä‘iá»‡n thoáº¡i",
    "discount_type": "percentage",
    "discount_value": 50,
    "product_id": "'$product_id'",
    "valid_from": "2025-12-01",
    "valid_until": "2025-12-31",
    "max_usage": 1000
  }'

$promo_data = $create_promotion | ConvertFrom-Json
Write-Host "âœ… Khuyáº¿n mÃ£i Ä‘Æ°á»£c táº¡o:"
Write-Host "ID: $($promo_data.id)"
Write-Host "TÃªn: $($promo_data.name)"
Write-Host "Giáº£m: $($promo_data.discount_value)%"
```

### Táº¡o MÃ£ Giáº£m GiÃ¡ (Coupon)

```powershell
# Táº¡o mÃ£ giáº£m giÃ¡
$create_coupon = curl -s -X POST "http://localhost:8007/api/coupons" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $admin_token" `
  -d '{
    "code": "NEWYEAR2025",
    "discount_percentage": 30,
    "max_usage": 500,
    "valid_from": "2025-01-01",
    "valid_until": "2025-01-31"
  }'

Write-Host "âœ… MÃ£ giáº£m giÃ¡ Ä‘Æ°á»£c táº¡o:"
Write-Host "MÃ£: NEWYEAR2025"
Write-Host "Giáº£m: 30%"
```

---

## â±ï¸ Admin BÆ°á»›c 8: Kiá»ƒm Tra ÄÃ¡nh GiÃ¡

```powershell
# Xem danh sÃ¡ch Ä‘Ã¡nh giÃ¡
$ratings = curl -s "http://localhost:8008/api/ratings/product/$product_id" | ConvertFrom-Json

Write-Host "â­ ÄÃ¡nh giÃ¡ sáº£n pháº©m:"
Write-Host "Äiá»ƒm trung bÃ¬nh: $($ratings.average_rating)/5"
Write-Host "Tá»•ng Ä‘Ã¡nh giÃ¡: $($ratings.total_ratings)"
Write-Host ""

$ratings.ratings | ForEach-Object {
    Write-Host "â­$($_.rating) - $($_.title)"
    Write-Host "  Tá»«: $($_.user.username)"
    Write-Host "  Nháº­n xÃ©t: $($_.comment)"
    Write-Host "---"
}
```

---

# ğŸ”— Báº¢NG TÃ“MBá»˜ LOCALHOST

| Chá»©c NÄƒng | Localhost | PhÆ°Æ¡ng Thá»©c | Cáº§n Token |
|-----------|-----------|------------|-----------|
| **ÄÄƒng kÃ½** | `8001/api/users/register` | POST | âŒ |
| **ÄÄƒng nháº­p** | `8001/api/users/login` | POST | âŒ |
| **Danh sÃ¡ch sáº£n pháº©m** | `8002/api/products` | GET | âŒ |
| **Chi tiáº¿t sáº£n pháº©m** | `8002/api/products/{id}` | GET | âŒ |
| **TÃ¬m kiáº¿m sáº£n pháº©m** | `8009/api/search` | GET | âŒ |
| **Táº¡o Ä‘Æ¡n hÃ ng** | `8003/api/orders` | POST | âœ… |
| **Danh sÃ¡ch Ä‘Æ¡n hÃ ng** | `8003/api/orders` | GET | âœ… |
| **Xem khuyáº¿n mÃ£i** | `8007/api/promotions` | GET | âŒ |
| **Ãp dá»¥ng coupon** | `8007/api/coupons/apply` | POST | âœ… |
| **TÃ­nh thuáº¿** | `8012/api/calculate-tax` | POST | âŒ |
| **Thanh toÃ¡n** | `8004/api/payments` | POST | âœ… |
| **ThÃ´ng bÃ¡o** | `8011/api/notifications` | GET | âœ… |
| **Tracking giao hÃ ng** | `8006/api/shipments/track/{number}` | GET | âŒ |
| **YÃªu thÃ­ch** | `8010/api/favourites` | POST/GET | âœ… |
| **ÄÃ¡nh giÃ¡** | `8008/api/ratings` | POST/GET | âœ… |
| **Danh sÃ¡ch Ä‘Ã¡nh giÃ¡** | `8008/api/ratings/product/{id}` | GET | âŒ |

---

# ğŸ“Š Báº¢NG TRáº NG THÃI & KAFKA EVENTS

## Tráº¡ng ThÃ¡i ÄÆ¡n HÃ ng
```
pending â†’ processing â†’ shipped â†’ delivered
              â†“
          cancelled (náº¿u há»§y)
```

## Tráº¡ng ThÃ¡i Thanh ToÃ¡n
```
pending â†’ completed
      â†“
     refunded (náº¿u hoÃ n tiá»n)
```

## Tráº¡ng ThÃ¡i Giao HÃ ng
```
pending â†’ picked_up â†’ in_transit â†’ out_for_delivery â†’ delivered
                  â†“
              returned (náº¿u tráº£ láº¡i)
```

## Kafka Events

| Sá»± kiá»‡n | Topic | Payload |
|---------|-------|---------|
| Táº¡o Ä‘Æ¡n hÃ ng | `order-events` | `{"order_id": 1, "status": "created"}` |
| Cáº­p nháº­t Ä‘Æ¡n hÃ ng | `order-events` | `{"order_id": 1, "status": "processing"}` |
| Thanh toÃ¡n hoÃ n thÃ nh | `payment-events` | `{"payment_id": 1, "order_id": 1, "status": "completed"}` |
| Giao hÃ ng báº¯t Ä‘áº§u | `shipping-events` | `{"shipment_id": 1, "status": "picked_up"}` |
| Giao hÃ ng hoÃ n thÃ nh | `shipping-events` | `{"shipment_id": 1, "status": "delivered"}` |

---

# ğŸ¬ SCRIPT DEMO HOÃ€N CHá»ˆNH (Copy & Paste)

Táº¡o file `demo_complete.ps1`:

```powershell
# ============================================
# COMPLETE ECOMMERCE DEMO SCRIPT
# ============================================

Write-Host "ğŸš€ START DEMO: Complete Ecommerce Flow" -ForegroundColor Green
Write-Host ""

# BÆ¯á»šC 1: ÄÄ‚NG KÃ
Write-Host "STEP 1ï¸âƒ£: ÄÄƒng kÃ½ tÃ i khoáº£n"
$register = curl -s -X POST "http://localhost:8001/api/users/register" `
  -H "Content-Type: application/json" `
  -d '{
    "email":"demo@test.com",
    "username":"demo_user",
    "password":"Demo@123",
    "full_name":"Nguyá»…n VÄƒn Demo",
    "phone":"0987654321",
    "address":"123 LÃª Lá»£i, TP.HCM"
  }'
$reg_data = $register | ConvertFrom-Json
Write-Host "âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng! User ID: $($reg_data.id)"
Write-Host ""

# BÆ¯á»šC 2: ÄÄ‚NG NHáº¬P
Write-Host "STEP 2ï¸âƒ£: ÄÄƒng nháº­p"
$login = curl -s -X POST "http://localhost:8001/api/users/login" `
  -H "Content-Type: application/json" `
  -d '{"username":"demo_user","password":"Demo@123"}'
$log_data = $login | ConvertFrom-Json
$token = $log_data.access_token
$user_id = $log_data.user_id
Write-Host "âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng!"
Write-Host ""

# BÆ¯á»šC 3: XEM DANH SÃCH Sáº¢N PHáº¨M
Write-Host "STEP 3ï¸âƒ£: Xem danh sÃ¡ch sáº£n pháº©m"
$products = curl -s "http://localhost:8002/api/products?skip=0&limit=5" | ConvertFrom-Json
Write-Host "âœ… TÃ¬m Ä‘Æ°á»£c $($products.total) sáº£n pháº©m"
$product_id = $products.products[0].id
$product_price = $products.products[0].price
Write-Host "   - Chá»n: $($products.products[0].name) - $product_price VND"
Write-Host ""

# BÆ¯á»šC 4: Táº O ÄÆ N HÃ€NG
Write-Host "STEP 4ï¸âƒ£: Táº¡o Ä‘Æ¡n hÃ ng"
$order = curl -s -X POST "http://localhost:8003/api/orders" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $token" `
  -d @"
{
  "user_id": $user_id,
  "items": [{"product_id":"$product_id","quantity":1,"price":$product_price}],
  "total_amount": $product_price,
  "status": "pending"
}
"@
$ord_data = $order | ConvertFrom-Json
$order_id = $ord_data.id
Write-Host "âœ… ÄÆ¡n hÃ ng Ä‘Æ°á»£c táº¡o! Order ID: $order_id"
Write-Host ""

# BÆ¯á»šC 5: TÃNH THUáº¾
Write-Host "STEP 5ï¸âƒ£: TÃ­nh thuáº¿"
$tax = curl -s -X POST "http://localhost:8012/api/calculate-tax" `
  -H "Content-Type: application/json" `
  -d @"
{"order_id":$order_id,"amount":$product_price,"location":"TP.HCM","items":[{"product_id":"$product_id","quantity":1,"price":$product_price}]}
"@
$tax_data = $tax | ConvertFrom-Json
Write-Host "âœ… Thuáº¿ tÃ­nh toÃ¡n: $($tax_data.tax_amount) VND"
Write-Host "   Tá»•ng cá»™ng: $($tax_data.total_with_tax) VND"
Write-Host ""

# BÆ¯á»šC 6: THANH TOÃN
Write-Host "STEP 6ï¸âƒ£: Thanh toÃ¡n"
$payment = curl -s -X POST "http://localhost:8004/api/payments" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $token" `
  -d @"
{
  "order_id": $order_id,
  "amount": $($tax_data.total_with_tax),
  "payment_method": "credit_card",
  "card_number": "4111111111111111",
  "status": "pending"
}
"@
$pay_data = $payment | ConvertFrom-Json
Write-Host "âœ… Thanh toÃ¡n hoÃ n thÃ nh! Payment ID: $($pay_data.id)"
Write-Host ""

# BÆ¯á»šC 7: THÃ”NG BÃO
Write-Host "STEP 7ï¸âƒ£: Kiá»ƒm tra thÃ´ng bÃ¡o"
$notifs = curl -s "http://localhost:8011/api/notifications?user_id=$user_id" `
  -H "Authorization: Bearer $token" | ConvertFrom-Json
Write-Host "âœ… CÃ³ $($notifs.unread_count) thÃ´ng bÃ¡o má»›i"
Write-Host ""

# BÆ¯á»šC 8: TRACKING GIAO HÃ€NG
Write-Host "STEP 8ï¸âƒ£: Tracking giao hÃ ng"
$shipments = curl -s "http://localhost:8006/api/shipments?order_id=$order_id" | ConvertFrom-Json
if ($shipments.shipments.Count -gt 0) {
    Write-Host "âœ… Tracking: $($shipments.shipments[0].tracking_number)"
}
Write-Host ""

# BÆ¯á»šC 9: ÄÃNH GIÃ
Write-Host "STEP 9ï¸âƒ£: ÄÃ¡nh giÃ¡ sáº£n pháº©m"
$rating = curl -s -X POST "http://localhost:8008/api/ratings" `
  -H "Content-Type: application/json" `
  -H "Authorization: Bearer $token" `
  -d @"
{
  "product_id": "$product_id",
  "user_id": $user_id,
  "rating": 5,
  "title": "Tuyá»‡t vá»i!",
  "comment": "Sáº£n pháº©m cháº¥t lÆ°á»£ng tá»‘t, giao hÃ ng nhanh"
}
"@
Write-Host "âœ… ÄÃ¡nh giÃ¡ hoÃ n thÃ nh!"
Write-Host ""

Write-Host "ğŸ‰ DEMO HOÃ€N Táº¤T!" -ForegroundColor Green
```

---

**âœ… Quy trÃ¬nh hoÃ n chá»‰nh tá»« Ä‘Äƒng kÃ½ Ä‘áº¿n Ä‘Ã¡nh giÃ¡!**

Sá»­ dá»¥ng tÃ i liá»‡u nÃ y Ä‘á»ƒ demo cho tháº§y cÃ´ báº¡n! ğŸ“š
